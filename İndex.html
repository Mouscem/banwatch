<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BanWatch</title>
  <style>
    body {
      margin: 0;
      background: #141414;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .navbar {
      display: flex;
      align-items: center;
      padding: 10px 30px;
      background-color: #111;
      position: sticky;
      top: 0;
      z-index: 1000;
      gap: 15px;
    }
    .logo {
      font-size: 28px;
      font-weight: 900;
      color: #e50914;
      flex-shrink: 0;
    }
    .search-input {
      flex-grow: 1;
      max-width: 400px;
      padding: 6px 12px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .user-panel {
      color: #eee;
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
    }
    #logoutBtn {
      display: none;
      margin-left: 10px;
      background: #e50914;
      border: none;
      color: #fff;
      font-weight: 700;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
    #authForms {
      max-width: 350px;
      margin: 30px auto;
      background: #222;
      padding: 20px;
      border-radius: 8px;
    }
    #authForms h2 {
      margin-top: 0;
      text-align: center;
      margin-bottom: 20px;
    }
    #authForms label {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
    }
    #authForms input {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border-radius: 4px;
      border: none;
      font-size: 16px;
    }
    #authForms button {
      width: 100%;
      padding: 10px;
      background: #e50914;
      border: none;
      color: white;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    #authForms .toggle-link {
      text-align: center;
      margin-top: 12px;
      cursor: pointer;
      color: #e50914;
      font-weight: 600;
      user-select: none;
    }
    .slider, .video-grid {
      display: none;
    }
    .slider {
      position: relative;
      max-width: 1200px;
      margin: 20px auto;
      overflow: hidden;
      border-radius: 10px;
      background: #000;
    }
    .slides {
      display: flex;
      transition: transform 0.6s ease;
    }
    .slide {
      min-width: 100%;
      position: relative;
      background: #000;
    }
    .slide iframe, .slide video {
      width: 100%;
      height: 450px;
      display: block;
    }
    .slide-title {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 1px 1px 4px #000;
    }
    .slider-nav {
      position: absolute;
      bottom: 15px;
      right: 15px;
      display: flex;
      gap: 10px;
    }
    .slider-nav button {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
    }
    .slider-nav button.active {
      background: #e50914;
    }
    .video-grid {
      max-width: 1200px;
      margin: 30px auto;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 20px;
      padding: 0 20px;
    }
    .video-card {
      background: #222;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.2s ease;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .video-card:hover {
      transform: scale(1.03);
    }
    .video-thumbnail {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .video-title {
      font-weight: 700;
      font-size: 16px;
      text-align: center;
      margin-bottom: 6px;
    }
    .video-rating {
      text-align: center;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .show-comments-btn {
      margin-bottom: 10px;
      cursor: pointer;
      padding: 5px 10px;
      background: #e50914;
      border: none;
      border-radius: 5px;
      color: #fff;
      font-weight: 700;
      width: 100%;
    }
    .comments-section {
      display: none;
      width: 100%;
      background: #333;
      padding: 10px;
      border-radius: 5px;
      max-height: 180px;
      overflow-y: auto;
      margin-bottom: 10px;
      color: #ddd;
    }
    .add-comment-section {
      display: none;
      width: 100%;
      margin-bottom: 10px;
    }
    .add-comment-section textarea {
      width: 100%;
      height: 60px;
      border-radius: 4px;
      padding: 5px;
      border: none;
      resize: vertical;
      font-size: 14px;
    }
    .add-comment-section select {
      margin-top: 5px;
      padding: 5px;
      border-radius: 4px;
      width: 100%;
      font-size: 14px;
      border: none;
    }
    .add-comment-section button {
      margin-top: 5px;
      background: #e50914;
      border: none;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 700;
      width: 100%;
    }
    #trailerOverlay {
      display: none;
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    #trailerBox {
      position: relative;
      width: 90%;
      max-width: 800px;
      background: #000;
      border-radius: 10px;
    }
    #trailerCloseBtn {
      position: absolute;
      top: 10px; right: 10px;
      background: #e50914;
      border: none;
      padding: 6px 12px;
      color: #fff;
      font-weight: 700;
      border-radius: 5px;
      cursor: pointer;
    }
    #trailerFrame, #trailerVideo {
      width: 100%;
      height: 450px;
      display: none;
    }
    @media (max-width: 768px) {
      #trailerFrame, #trailerVideo {
        height: 250px;
      }
    }
  </style>
</head>
<body>

<div class="navbar">
  <div class="logo">BanWatch</div>
  <input type="text" id="searchInput" placeholder="Film ara..." class="search-input" />
  <div class="user-panel" id="userPanel">Giriş yapılmadı</div>
  <button id="logoutBtn">Çıkış</button>
</div>

<div id="authForms">
  <h2 id="formTitle">Giriş Yap</h2>
  <form id="authForm">
    <label for="username">Kullanıcı Adı</label>
    <input type="text" id="username" required autocomplete="off" />
    <label for="password">Şifre</label>
    <input type="password" id="password" required autocomplete="off" />
    <button type="submit" id="submitBtn">Giriş Yap</button>
  </form>
  <div class="toggle-link" id="toggleAuth">Hesabın yok mu? Kayıt ol</div>
</div>

<div class="slider">
  <div class="slides" id="slides"></div>
  <div class="slider-nav" id="sliderNav"></div>
</div>

<div class="video-grid" id="videoGrid"></div>

<div id="trailerOverlay">
  <div id="trailerBox">
    <button id="trailerCloseBtn">Kapat</button>
    <iframe id="trailerFrame" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <video id="trailerVideo" controls autoplay></video>
  </div>
</div>

<script>
const sliderVideos = [
  {
    title: "Kurtlar Vadisi Filistin",
    url: "https://www.youtube.com/embed/dWn9WIBojtc",
    thumbnail: "https://img.youtube.com/vi/8hP9D6kZseM/hqdefault.jpg"
  },
  {
    title: "Nasıl Yani",
    url: "https://www.youtube.com/embed/InpUv8rtH1M",
    thumbnail: "https://via.placeholder.com/320x180.png?text=Demo+Video"
  }
];

const otherVideos = [
  {
    title: "Kurtlar Vadisi: Filistin",
    url: "https://www.youtube.com/embed/hmKMlf8_FOs",
    thumbnail: "https://i.ytimg.com/vi/hmKMlf8_FOs/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLBWhLbiHOG1d1bXWBg77b_bZaMCDQ"
  },
  {
    title: "Filme Gel",
    url: "https://www.youtube.com/embed/6B_lku8eQTk",
    thumbnail: "https://i.ytimg.com/vi/6B_lku8eQTk/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLDeFqhowR_s4jq4jwpcIqRWpU8-LQ"
  },
  {
    title: "Dağ 1 - Bir Ölür Bin Diriliriz",
    url: "https://www.youtube.com/embed/e-tiP1yNAks",
    thumbnail: "https://i.ytimg.com/vi/e-tiP1yNAks/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLDwUUFPcSyjGqqf0bT13FzaOYbhxg"
  },
  {
    title: "Mutluluk",
    url: "https://youtube.com/embed/tL3iB2uJJBI	",
    thumbnail: "https://img.youtube.com/vi/tL3iB2uJJBI/hqdefault.jpg"
  },
  {
    title: "AF",
    url: "https://youtube.com/embed/raPwrmcx_fo",
    thumbnail: "https://img.youtube.com/vi/raPwrmcx_fo/hqdefault.jpg"
  },
  {
    title: "Kurtlar Vadisi: Irak",
    url: "https://www.youtube.com/embed/I5GR5tub_hA",
    thumbnail: "https://img.youtube.com/vi/I5GR5tub_hA/hqdefault.jpg"
  },
  {
    title: "Son Kahramanlar",
    url: "https://youtube.com/embed/ZaX0saPvWbI",
    thumbnail: "https://img.youtube.com/vi/ZaX0saPvWbI/hqdefault.jpg"
  },
  {
    title: "Bücür",
    url: "https://www.youtube.com/embed/HfcnheC4tb8",
    thumbnail: "https://img.youtube.com/vi/HfcnheC4tb8/hqdefault.jpg"
  },
  {
    title: "Ben O Değilim",
    url: "https://www.youtube.com/embed/BWgrVCbuz_Q",
    thumbnail: "https://img.youtube.com/vi/BWgrVCbuz_Q/hqdefault.jpg "
  },
  {
    title: "Sultan",
    url: "https://www.youtube.com/embed/GVHNNDUNtZE",
    thumbnail: "https://img.youtube.com/vi/GVHNNDUNtZE/hqdefault.jpg"
  },
  {
    title: "Çatlak",
    url: "https://www.youtube.com/embed/3atmXYaEUZk",
    thumbnail: "https://img.youtube.com/vi/3atmXYaEUZk/hqdefault.jpg"
  },
  {
    title: "Sarı Mercedes",
    url: "https://www.youtube.com/embed/FeKOTHujBhc",
    thumbnail: "https://i.ytimg.com/vi/OJgUxjY3lxU/maxresdefault.jpg"
  },
  {
    title: "Nasıl Yani",
    url: "https://www.youtube.com/embed/SW5GmtqUPEI",
    thumbnail: "https://i.ytimg.com/vi/SW5GmtqUPEI/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLAlt-MFumlrcvdckyRr95Pa1lQ2cA"
  }
];

const slidesEl = document.getElementById('slides');
const sliderNavEl = document.getElementById('sliderNav');
const videoGridEl = document.getElementById('videoGrid');
const searchInput = document.getElementById('searchInput');
const trailerOverlay = document.getElementById('trailerOverlay');
const trailerFrame = document.getElementById('trailerFrame');
const trailerVideo = document.getElementById('trailerVideo');
const trailerCloseBtn = document.getElementById('trailerCloseBtn');
const userPanel = document.getElementById('userPanel');
const authForms = document.getElementById('authForms');
const authForm = document.getElementById('authForm');
const formTitle = document.getElementById('formTitle');
const submitBtn = document.getElementById('submitBtn');
const toggleAuth = document.getElementById('toggleAuth');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const logoutBtn = document.getElementById('logoutBtn');

let currentSlide = 0;
let slideInterval;
let isLoginMode = true;

function saveUser(username, password) {
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[username] = password;
  localStorage.setItem('users', JSON.stringify(users));
}

function getUserPassword(username) {
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  return users[username] || null;
}

function userExists(username) {
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  return username in users;
}

function setLoggedInUser(username) {
  localStorage.setItem('loggedInUser', username);
}

function getLoggedInUser() {
  return localStorage.getItem('loggedInUser');
}

function logoutUser() {
  localStorage.removeItem('loggedInUser');
}

function updateUserPanel() {
  const user = getLoggedInUser();
  const sliderEl = document.querySelector('.slider');
  const gridEl = document.querySelector('.video-grid');

  if (user) {
    userPanel.textContent = `Hoşgeldin, ${user}`;
    authForms.style.display = 'none';
    sliderEl.style.display = 'block';
    gridEl.style.display = 'grid';
    logoutBtn.style.display = 'inline-block';
  } else {
    userPanel.textContent = 'Giriş yapılmadı';
    authForms.style.display = 'block';
    sliderEl.style.display = 'none';
    gridEl.style.display = 'none';
    logoutBtn.style.display = 'none';
  }
}

authForm.addEventListener('submit', e => {
  e.preventDefault();
  const username = usernameInput.value.trim();
  const password = passwordInput.value;

  if (!username || !password) {
    alert("Lütfen kullanıcı adı ve şifre giriniz.");
    return;
  }

  if (isLoginMode) {
    if (!userExists(username)) {
      alert("Kullanıcı bulunamadı. Kayıt olun.");
      return;
    }
    const savedPassword = getUserPassword(username);
    if (savedPassword !== password) {
      alert("Şifre yanlış.");
      return;
    }
    setLoggedInUser(username);
    updateUserPanel();
  } else {
    if (userExists(username)) {
      alert("Bu kullanıcı adı zaten alınmış.");
      return;
    }
    saveUser(username, password);
    alert("Kayıt başarılı! Şimdi giriş yapabilirsiniz.");
    toggleAuthMode();
  }

  authForm.reset();
});

function toggleAuthMode() {
  isLoginMode = !isLoginMode;
  if (isLoginMode) {
    formTitle.textContent = "Giriş Yap";
    submitBtn.textContent = "Giriş Yap";
    toggleAuth.textContent = "Hesabın yok mu? Kayıt ol";
  } else {
    formTitle.textContent = "Kayıt Ol";
    submitBtn.textContent = "Kayıt Ol";
    toggleAuth.textContent = "Zaten hesabın var mı? Giriş yap";
  }
}
toggleAuth.addEventListener('click', () => {
  toggleAuthMode();
});

logoutBtn.addEventListener('click', () => {
  logoutUser();
  updateUserPanel();
});

// Slider fonksiyonları
function renderSlides() {
  slidesEl.innerHTML = '';
  sliderNavEl.innerHTML = '';

  sliderVideos.forEach((video, index) => {
    const slide = document.createElement('div');
    slide.className = 'slide';

    if (video.url.includes('youtube.com')) {
      slide.innerHTML = `
        <iframe src="${video.url}?autoplay=1&mute=1&loop=1&playlist=${getVideoId(video.url)}" allow="autoplay" allowfullscreen></iframe>
        <div class="slide-title">${video.title}</div>
      `;
    } else {
      slide.innerHTML = `
        <video autoplay muted loop playsinline>
          <source src="${video.url}" type="video/mp4" />
        </video>
        <div class="slide-title">${video.title}</div>
      `;
    }

    slidesEl.appendChild(slide);

    const btn = document.createElement('button');
    btn.addEventListener('click', () => {
      goToSlide(index);
      resetInterval();
    });
    if(index === 0) btn.classList.add('active');
    sliderNavEl.appendChild(btn);
  });
}

function getVideoId(url) {
  const match = url.match(/embed\/([a-zA-Z0-9_-]+)/);
  return match ? match[1] : "";
}

function goToSlide(n) {
  currentSlide = n;
  slidesEl.style.transform = `translateX(-${n * 100}%)`;
  [...sliderNavEl.children].forEach((btn, i) => {
    btn.classList.toggle('active', i === n);
  });
}

function nextSlide() {
  currentSlide = (currentSlide + 1) % sliderVideos.length;
  goToSlide(currentSlide);
}

function resetInterval() {
  clearInterval(slideInterval);
  slideInterval = setInterval(nextSlide, 6000);
}

function openTrailer(video) {
  if (video.url.endsWith('.mp4')) {
    trailerVideo.src = video.url;
    trailerVideo.style.display = 'block';
    trailerFrame.style.display = 'none';
  } else {
    trailerFrame.src = video.url + "?autoplay=1";
    trailerFrame.style.display = 'block';
    trailerVideo.style.display = 'none';
  }
  trailerOverlay.style.display = 'flex';
}

function closeTrailer() {
  trailerOverlay.style.display = 'none';
  trailerFrame.src = '';
  trailerVideo.src = '';
}

trailerCloseBtn.onclick = closeTrailer;
trailerOverlay.onclick = e => { if(e.target === trailerOverlay) closeTrailer(); };

// Yorum ve puanlama sistemi
function getComments() {
  return JSON.parse(localStorage.getItem('comments') || '{}');
}

function saveComment(videoTitle, commentObj) {
  const comments = getComments();
  if (!comments[videoTitle]) comments[videoTitle] = [];
  comments[videoTitle].push(commentObj);
  localStorage.setItem('comments', JSON.stringify(comments));
}

function getCommentsByVideo(videoTitle) {
  const comments = getComments();
  return comments[videoTitle] || [];
}

function calculateAvgRating(videoTitle) {
  const comments = getCommentsByVideo(videoTitle);
  if (comments.length === 0) return null;
  const sum = comments.reduce((acc, c) => acc + c.rating, 0);
  return (sum / comments.length).toFixed(1);
}

function setupComments(card, video) {
  const commentsSection = card.querySelector('.comments-section');
  const addCommentSection = card.querySelector('.add-comment-section');
  const showCommentsBtn = card.querySelector('.show-comments-btn');
  const avgRatingEl = card.querySelector('.avg-rating');

  function renderComments() {
    const comments = getCommentsByVideo(video.title);
    if (comments.length === 0) {
      commentsSection.innerHTML = '<i>Henüz yorum yok.</i>';
    } else {
      commentsSection.innerHTML = comments.map(c => `
        <div style="border-bottom:1px solid #555; margin-bottom:5px; padding-bottom:5px;">
          <b>${c.user}</b> — ${c.rating} ⭐<br>
          ${escapeHtml(c.text)}
        </div>
      `).join('');
    }
    const avg = calculateAvgRating(video.title);
    avgRatingEl.textContent = avg ? avg + ' ⭐' : 'Henüz yok';
  }

  showCommentsBtn.onclick = e => {
    e.stopPropagation(); // video açılmasını engelle
    const isVisible = commentsSection.style.display === 'block';
    commentsSection.style.display = isVisible ? 'none' : 'block';
    addCommentSection.style.display = isVisible ? 'none' : 'block';
    showCommentsBtn.textContent = isVisible ? 'Yorumları Göster' : 'Yorumları Gizle';
  };

  // Burada yorum alanlarında tıklamayı durduruyoruz, böylece video açılmaz
  commentsSection.onclick = e => e.stopPropagation();
  addCommentSection.onclick = e => e.stopPropagation();

  const textarea = addCommentSection.querySelector('textarea');
  const select = addCommentSection.querySelector('select');
  const sendBtn = addCommentSection.querySelector('button');

  sendBtn.onclick = e => {
    e.stopPropagation();
    const user = getLoggedInUser() || 'Misafir';
    const text = textarea.value.trim();
    const rating = parseInt(select.value);

    if (!text) {
      alert('Lütfen yorumunuzu yazın.');
      return;
    }

    saveComment(video.title, {user, text, rating});
    textarea.value = '';
    select.value = '3';
    renderComments();
  };

  renderComments();
}

function escapeHtml(text) {
  return text.replace(/[&<>"']/g, function(m) {
    return ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    })[m];
  });
}

function renderGrid(videos) {
  videoGridEl.innerHTML = '';
  videos.forEach(video => {
    const card = document.createElement('div');
    card.className = 'video-card';
    card.innerHTML = `
      <img class="video-thumbnail" src="${video.thumbnail}" />
      <div class="video-title">${video.title}</div>
      <div class="video-rating">
        Ortalama Puan: <span class="avg-rating">Henüz yok</span>
      </div>
      <button class="show-comments-btn">Yorumları Göster</button>
      <div class="comments-section"></div>
      <div class="add-comment-section">
        <textarea placeholder="Yorumunuzu yazın..."></textarea>
        <select>
          <option value="1">1 ⭐</option>
          <option value="2">2 ⭐⭐</option>
          <option value="3" selected>3 ⭐⭐⭐</option>
          <option value="4">4 ⭐⭐⭐⭐</option>
          <option value="5">5 ⭐⭐⭐⭐⭐</option>
        </select>
        <button>Gönder</button>
      </div>
    `;
    setupComments(card, video);
    card.onclick = () => openTrailer(video);
    videoGridEl.appendChild(card);
  });
}

searchInput.addEventListener('input', () => {
  const q = searchInput.value.toLowerCase();
  const filtered = otherVideos.filter(v => v.title.toLowerCase().includes(q));
  renderGrid(filtered);
});

// Sayfa yüklendiğinde
updateUserPanel();
renderSlides();
goToSlide(0);
resetInterval();
renderGrid(otherVideos);

</script>

</body>
</html>
